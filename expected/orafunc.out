\set ECHO none
psql:orafunc.sql:145: NOTICE:  schema "plvstr" does not exist, skipping
psql:orafunc.sql:182: NOTICE:  schema "oracle" does not exist, skipping
psql:orafunc.sql:197: NOTICE:  table "dual" does not exist, skipping
psql:orafunc.sql:210: NOTICE:  schema "dbms_output" does not exist, skipping
psql:orafunc.sql:288: NOTICE:  schema "dbms_pipe" does not exist, skipping
psql:orafunc.sql:467: NOTICE:  schema "plvdate" does not exist, skipping
psql:orafunc.sql:795: NOTICE:  schema "plvchr" does not exist, skipping
psql:orafunc.sql:927: NOTICE:  schema "dbms_alert" does not exist, skipping
psql:orafunc.sql:986: NOTICE:  schema "plvsubst" does not exist, skipping
psql:orafunc.sql:1037: NOTICE:  schema "dbms_utility" does not exist, skipping
psql:orafunc.sql:1052: NOTICE:  schema "plvlex" does not exist, skipping
psql:orafunc.sql:1062: NOTICE:  schema "utl_file" does not exist, skipping
psql:orafunc.sql:1245: NOTICE:  schema "dbms_assert" does not exist, skipping
psql:orafunc.sql:1296: NOTICE:  schema "plunit" does not exist, skipping
--
-- test built-in date type oracle compatibility functions
--
SELECT add_months ('2003-08-01', 3);
 add_months 
------------
 2003-11-01
(1 row)

SELECT add_months ('2003-08-01', -3);
 add_months 
------------
 2003-05-01
(1 row)

SELECT add_months ('2003-08-21', -3);
 add_months 
------------
 2003-05-21
(1 row)

SELECT add_months ('2003-01-31', 1);
 add_months 
------------
 2003-02-28
(1 row)

SELECT last_day (to_date('2003/03/15', 'yyyy/mm/dd'));
  last_day  
------------
 2003-03-31
(1 row)

SELECT last_day (to_date('2003/02/03', 'yyyy/mm/dd'));
  last_day  
------------
 2003-02-28
(1 row)

SELECT last_day (to_date('2004/02/03', 'yyyy/mm/dd'));
  last_day  
------------
 2004-02-29
(1 row)

SELECT next_day ('2003-08-01', 'TUESDAY');
  next_day  
------------
 2003-08-05
(1 row)

SELECT next_day ('2003-08-06', 'WEDNESDAY');
  next_day  
------------
 2003-08-13
(1 row)

SELECT next_day ('2003-08-06', 'SUNDAY');
  next_day  
------------
 2003-08-10
(1 row)

SELECT months_between (to_date ('2003/01/01', 'yyyy/mm/dd'), to_date ('2003/03/14', 'yyyy/mm/dd'));
  months_between   
-------------------
 -2.41935483870968
(1 row)

SELECT months_between (to_date ('2003/07/01', 'yyyy/mm/dd'), to_date ('2003/03/14', 'yyyy/mm/dd'));
  months_between  
------------------
 3.58064516129032
(1 row)

SELECT months_between (to_date ('2003/07/02', 'yyyy/mm/dd'), to_date ('2003/07/02', 'yyyy/mm/dd'));
 months_between 
----------------
              0
(1 row)

SELECT months_between (to_date ('2003/08/02', 'yyyy/mm/dd'), to_date ('2003/06/02', 'yyyy/mm/dd'));
 months_between 
----------------
              2
(1 row)

select length('jmenuji se Pavel Stehule'),dbms_pipe.pack_message('jmenuji se Pavel Stehule');
 length | pack_message 
--------+--------------
     24 | 
(1 row)

select length('a bydlim ve Skalici'),dbms_pipe.pack_message('a bydlim ve Skalici');
 length | pack_message 
--------+--------------
     19 | 
(1 row)

select dbms_pipe.send_message('pavel',0,1);
 send_message 
--------------
            0
(1 row)

select dbms_pipe.send_message('pavel',0,2);
 send_message 
--------------
            0
(1 row)

select dbms_pipe.receive_message('pavel',0);
 receive_message 
-----------------
               0
(1 row)

select '>>>>'||dbms_pipe.unpack_message_text()||'<<<<';
             ?column?             
----------------------------------
 >>>>jmenuji se Pavel Stehule<<<<
(1 row)

select '>>>>'||dbms_pipe.unpack_message_text()||'<<<<';
          ?column?           
-----------------------------
 >>>>a bydlim ve Skalici<<<<
(1 row)

select dbms_pipe.receive_message('pavel',0);
 receive_message 
-----------------
               0
(1 row)

select dbms_pipe.purge('bob');
 purge 
-------
 
(1 row)

select dbms_pipe.reset_buffer();
 reset_buffer 
--------------
 
(1 row)

select dbms_pipe.pack_message('012345678901234+1');
 pack_message 
--------------
 
(1 row)

select dbms_pipe.send_message('bob',0,10);
 send_message 
--------------
            0
(1 row)

select dbms_pipe.pack_message('012345678901234+2');
 pack_message 
--------------
 
(1 row)

select dbms_pipe.send_message('bob',0,10);
 send_message 
--------------
            0
(1 row)

select dbms_pipe.pack_message('012345678901234+3');
 pack_message 
--------------
 
(1 row)

select dbms_pipe.send_message('bob',0,10);
 send_message 
--------------
            0
(1 row)

--------------------------------------------
select dbms_pipe.receive_message('bob',0);
 receive_message 
-----------------
               0
(1 row)

select dbms_pipe.unpack_message_text();
 unpack_message_text 
---------------------
 012345678901234+1
(1 row)

select dbms_pipe.receive_message('bob',0);
 receive_message 
-----------------
               0
(1 row)

select dbms_pipe.unpack_message_text();
 unpack_message_text 
---------------------
 012345678901234+2
(1 row)

select dbms_pipe.receive_message('bob',0);
 receive_message 
-----------------
               0
(1 row)

select dbms_pipe.unpack_message_text();
 unpack_message_text 
---------------------
 012345678901234+3
(1 row)

select dbms_pipe.unique_session_name() LIKE 'PG$PIPE$%';
 ?column? 
----------
 t
(1 row)

select dbms_pipe.pack_message('012345678901234-1');
 pack_message 
--------------
 
(1 row)

select dbms_pipe.send_message('bob',0,10);
 send_message 
--------------
            0
(1 row)

select dbms_pipe.receive_message('bob',0);
 receive_message 
-----------------
               0
(1 row)

select dbms_pipe.unpack_message_text();
 unpack_message_text 
---------------------
 012345678901234-1
(1 row)

select dbms_pipe.pack_message('012345678901234-2');
 pack_message 
--------------
 
(1 row)

select dbms_pipe.send_message('bob',0,10);
 send_message 
--------------
            0
(1 row)

select dbms_pipe.send_message('bob',0,10);
 send_message 
--------------
            0
(1 row)

select dbms_pipe.receive_message('bob',0);
 receive_message 
-----------------
               0
(1 row)

select dbms_pipe.unpack_message_text();
 unpack_message_text 
---------------------
 012345678901234-2
(1 row)

select dbms_pipe.pack_message(TO_DATE('2006-10-11', 'YYYY-MM-DD'));
 pack_message 
--------------
 
(1 row)

select dbms_pipe.send_message('test_date');
 send_message 
--------------
            0
(1 row)

select dbms_pipe.receive_message('test_date');
 receive_message 
-----------------
               0
(1 row)

select dbms_pipe.next_item_type();
 next_item_type 
----------------
             12
(1 row)

select dbms_pipe.unpack_message_date();
 unpack_message_date 
---------------------
 2006-10-11
(1 row)

select dbms_pipe.pack_message(current_timestamp);
 pack_message 
--------------
 
(1 row)

select dbms_pipe.send_message('test_date');
 send_message 
--------------
            0
(1 row)

select dbms_pipe.receive_message('test_date');
 receive_message 
-----------------
               0
(1 row)

select dbms_pipe.next_item_type();
 next_item_type 
----------------
             13
(1 row)

select to_char(dbms_pipe.unpack_message_timestamp(),'YYYY-MM-DD::hh24:ss:mm') = to_char(current_timestamp,'YYYY-MM-DD::hh24:ss:mm');
 ?column? 
----------
 t
(1 row)

select dbms_pipe.pack_message(6262626262::numeric);
 pack_message 
--------------
 
(1 row)

select dbms_pipe.send_message('test_int');
 send_message 
--------------
            0
(1 row)

select dbms_pipe.receive_message('test_int');
 receive_message 
-----------------
               0
(1 row)

select dbms_pipe.next_item_type();
 next_item_type 
----------------
              9
(1 row)

select dbms_pipe.unpack_message_number();
 unpack_message_number 
-----------------------
            6262626262
(1 row)

select PLVstr.betwn('Harry and Sally are very happy', 7, 9);
 betwn 
-------
 and
(1 row)

select PLVstr.betwn('Harry and Sally are very happy', 7, 9, FALSE);
 betwn 
-------
 n
(1 row)

select PLVstr.betwn('Harry and Sally are very happy', -3, -1);
 betwn 
-------
 ppy
(1 row)

select PLVstr.betwn('Harry and Sally are very happy', 'a', 'ry');
 betwn 
-------
 arry
(1 row)

select PLVstr.betwn('Harry and Sally are very happy', 'a', 'ry', 1,1,FALSE,FALSE);
 betwn 
-------
 r
(1 row)

select PLVstr.betwn('Harry and Sally are very happy', 'a', 'ry', 2,1,TRUE,FALSE);
       betwn        
--------------------
 and Sally are very
(1 row)

select PLVstr.betwn('Harry and Sally are very happy', 'a', 'y', 2,1);
   betwn   
-----------
 and Sally
(1 row)

select PLVstr.betwn('Harry and Sally are very happy', 'a', 'a', 2, 2);
    betwn    
-------------
 and Sally a
(1 row)

select PLVstr.betwn('Harry and Sally are very happy', 'a', 'a', 2, 3, FALSE,FALSE);
        betwn        
---------------------
 nd Sally are very h
(1 row)

select plvsubst.string('My name is %s %s.', ARRAY['Pavel','Stěhule']);
          string           
---------------------------
 My name is Pavel Stěhule.
(1 row)

select plvsubst.string('My name is % %.', ARRAY['Pavel','Stěhule'], '%');
          string           
---------------------------
 My name is Pavel Stěhule.
(1 row)

select plvsubst.string('My name is %s.', ARRAY['Stěhule']);
       string        
---------------------
 My name is Stěhule.
(1 row)

select plvsubst.string('My name is %s %s.', 'Pavel,Stěhule');
          string           
---------------------------
 My name is Pavel Stěhule.
(1 row)

select plvsubst.string('My name is %s %s.', 'Pavel|Stěhule','|');
          string           
---------------------------
 My name is Pavel Stěhule.
(1 row)

select plvsubst.string('My name is %s.', 'Stěhule');
       string        
---------------------
 My name is Stěhule.
(1 row)

select round(to_date ('22-AUG-03', 'DD-MON-YY'),'YEAR')  =  to_date ('01-JAN-04', 'DD-MON-YY');
 ?column? 
----------
 t
(1 row)

select round(to_date ('22-AUG-03', 'DD-MON-YY'),'Q')  =  to_date ('01-OCT-03', 'DD-MON-YY');
 ?column? 
----------
 t
(1 row)

select round(to_date ('22-AUG-03', 'DD-MON-YY'),'MONTH') =  to_date ('01-SEP-03', 'DD-MON-YY');
 ?column? 
----------
 t
(1 row)

select round(to_date ('22-AUG-03', 'DD-MON-YY'),'DDD')  =  to_date ('22-AUG-03', 'DD-MON-YY');
 ?column? 
----------
 t
(1 row)

select round(to_date ('22-AUG-03', 'DD-MON-YY'),'DAY')  =  to_date ('24-AUG-03', 'DD-MON-YY');
 ?column? 
----------
 t
(1 row)

select trunc(to_date('22-AUG-03', 'DD-MON-YY'), 'YEAR')  =  to_date ('01-JAN-03', 'DD-MON-YY');
 ?column? 
----------
 t
(1 row)

select trunc(to_date('22-AUG-03', 'DD-MON-YY'), 'Q')  =  to_date ('01-JUL-03', 'DD-MON-YY');
 ?column? 
----------
 t
(1 row)

select trunc(to_date('22-AUG-03', 'DD-MON-YY'), 'MONTH') =  to_date ('01-AUG-03', 'DD-MON-YY');                                                                       
 ?column? 
----------
 t
(1 row)

select trunc(to_date('22-AUG-03', 'DD-MON-YY'), 'DDD')  =  to_date ('22-AUG-03', 'DD-MON-YY');
 ?column? 
----------
 t
(1 row)

select trunc(to_date('22-AUG-03', 'DD-MON-YY'), 'DAY')  =  to_date ('17-AUG-03', 'DD-MON-YY');
 ?column? 
----------
 t
(1 row)

select next_day(to_date('01-Aug-03', 'DD-MON-YY'), 'TUESDAY')  =  to_date ('05-Aug-03', 'DD-MON-YY');                                                                 
 ?column? 
----------
 t
(1 row)

select next_day(to_date('06-Aug-03', 'DD-MON-YY'), 'WEDNESDAY') =  to_date ('13-Aug-03', 'DD-MON-YY');
 ?column? 
----------
 t
(1 row)

select next_day(to_date('06-Aug-03', 'DD-MON-YY'), 'SUNDAY')  =  to_date ('10-Aug-03', 'DD-MON-YY');
 ?column? 
----------
 t
(1 row)

select last_day(to_date('2003/03/15', 'yyyy/mm/dd'))   =  to_date ('Mar 31, 2003', 'Mon DD, YYYY');
 ?column? 
----------
 t
(1 row)

select last_day(to_date('2003/02/03', 'yyyy/mm/dd'))  =  to_date ('Feb 28, 2003', 'Mon DD, YYYY');
 ?column? 
----------
 t
(1 row)

select last_day(to_date('2004/02/03', 'yyyy/mm/dd'))  =  to_date ('Feb 29, 2004', 'Mon DD, YYYY');
 ?column? 
----------
 t
(1 row)

select instr('Tech on the net', 'e') =2;
 ?column? 
----------
 t
(1 row)

select instr('Tech on the net', 'e', 1, 1) = 2;
 ?column? 
----------
 t
(1 row)

select instr('Tech on the net', 'e', 1, 2) = 11;
 ?column? 
----------
 t
(1 row)

select instr('Tech on the net', 'e', 1, 3) = 14;
 ?column? 
----------
 t
(1 row)

select instr('Tech on the net', 'e', -3, 2) = 2;
 ?column? 
----------
 t
(1 row)

select oracle.substr('This is a test', 6, 2) = 'is';
 ?column? 
----------
 t
(1 row)

select oracle.substr('This is a test', 6) =  'is a test';
 ?column? 
----------
 t
(1 row)

select oracle.substr('TechOnTheNet', 1, 4) =  'Tech';
 ?column? 
----------
 t
(1 row)

select oracle.substr('TechOnTheNet', -3, 3) =  'Net';
 ?column? 
----------
 t
(1 row)

select oracle.substr('TechOnTheNet', -6, 3) =  'The';
 ?column? 
----------
 t
(1 row)

select oracle.substr('TechOnTheNet', -8, 2) =  'On';
 ?column? 
----------
 t
(1 row)

select concat('Tech on', ' the Net') =  'Tech on the Net';
 ?column? 
----------
 t
(1 row)

select concat('a', 'b') =  'ab';
 ?column? 
----------
 t
(1 row)

select PLVstr.rvrs ('Jumping Jack Flash') ='hsalF kcaJ gnipmuJ';
 ?column? 
----------
 t
(1 row)

select PLVstr.rvrs ('Jumping Jack Flash', 9) = 'hsalF kcaJ';
 ?column? 
----------
 t
(1 row)

select PLVstr.rvrs ('Jumping Jack Flash', 4, 6) = 'nip';
 ?column? 
----------
 t
(1 row)

select PLVstr.lstrip ('*val1|val2|val3|*', '*') = 'val1|val2|val3|*';
 ?column? 
----------
 t
(1 row)

select PLVstr.lstrip (',,,val1,val2,val3,', ',', 3)= 'val1,val2,val3,';
 ?column? 
----------
 t
(1 row)

select PLVstr.lstrip ('WHERE WHITE = ''FRONT'' AND COMP# = 1500', 'WHERE ') = 'WHITE = ''FRONT'' AND COMP# = 1500';
 ?column? 
----------
 t
(1 row)

select plvstr.left('Příliš žluťoučký kůň',4) = 'Příl';
 ?column? 
----------
 t
(1 row)

select pos,token from plvlex.tokens('select * from a.b.c join d ON x=y', true, true);
 pos | token  
-----+--------
   0 | select
   7 | *
   9 | from
  14 | a.b.c
  20 | join
  25 | d
  27 | on
  30 | x
  31 | =
  32 | y
(10 rows)

SET lc_numeric TO 'C';
select to_char(22);
 to_char 
---------
 22
(1 row)

select to_char(-44444);
 to_char 
---------
 -44444
(1 row)

select to_char(1234567890123456::bigint);
     to_char      
------------------
 1234567890123456
(1 row)

select to_char(123.456::real);
  to_char   
------------
 123.456001
(1 row)

select to_char(1234.5678::double precision);
   to_char   
-------------
 1234.567800
(1 row)

select to_char(12345678901234567890::numeric);
       to_char        
----------------------
 12345678901234567890
(1 row)

select to_char(1234567890.12345);
     to_char      
------------------
 1234567890.12345
(1 row)

select dbms_assert.enquote_literal(E'some text \' some text');
     enquote_literal      
--------------------------
 'some text '' some text'
(1 row)

select dbms_assert.enquote_name(E'\'"AAA');
 enquote_name 
--------------
 "'""aaa"
(1 row)

select dbms_assert.enquote_name(E'\'"AAA', false);
 enquote_name 
--------------
 "'""AAA"
(1 row)

select dbms_assert.noop('some string');
    noop     
-------------
 some string
(1 row)

select dbms_assert.qualified_sql_name('aaa.bbb.ccc."aaaa""aaa"');
   qualified_sql_name    
-------------------------
 aaa.bbb.ccc."aaaa""aaa"
(1 row)

select dbms_assert.qualified_sql_name('aaa.bbb.cc%c."aaaa""aaa"');
ERROR:  string is not qualified SQL name
select dbms_assert.schema_name('dbms_assert');
 schema_name 
-------------
 dbms_assert
(1 row)

select dbms_assert.schema_name('jabadabado');
ERROR:  invalid schema name
select dbms_assert.simple_sql_name('"Aaa dghh shsh"');
 simple_sql_name 
-----------------
 "Aaa dghh shsh"
(1 row)

select dbms_assert.simple_sql_name('ajajaj -- ajaj');
ERROR:  string is not simple SQL name
select dbms_assert.object_name('pg_catalog.pg_class');
     object_name     
---------------------
 pg_catalog.pg_class
(1 row)

select dbms_assert.object_name('dbms_assert.fooo');
ERROR:  invalid object name
select plunit.assert_true(NULL);
ERROR:  plunit.assert_true exception
DETAIL:  Plunit.assertation fails (assert_true).
select plunit.assert_true(1 = 2);
ERROR:  plunit.assert_true exception
DETAIL:  Plunit.assertation fails (assert_true).
select plunit.assert_true(1 = 2, 'one is not two');
ERROR:  one is not two
DETAIL:  Plunit.assertation fails (assert_true).
select plunit.assert_true(1 = 1);
 assert_true 
-------------
 
(1 row)

select plunit.assert_false(1 = 1);
ERROR:  plunit.assert_false exception
DETAIL:  Plunit.assertation fails (assert_false).
select plunit.assert_false(1 = 1, 'trap is open');
ERROR:  trap is open
DETAIL:  Plunit.assertation fails (assert_false).
select plunit.assert_false(NULL);
ERROR:  plunit.assert_false exception
DETAIL:  Plunit.assertation fails (assert_false).
select plunit.assert_null(current_date);
ERROR:  plunit.assert_null exception
DETAIL:  Plunit.assertation fails (assert_null).
select plunit.assert_null(NULL::date);
 assert_null 
-------------
 
(1 row)

select plunit.assert_not_null(current_date);
 assert_not_null 
-----------------
 
(1 row)

select plunit.assert_not_null(NULL::date);
ERROR:  plunit.assert_not_null exception
DETAIL:  Plunit.assertation fails (assert_not_null).
select plunit.assert_equals('Pavel','Pa'||'vel');
 assert_equals 
---------------
 
(1 row)

select plunit.assert_equals(current_date, current_date + 1, 'diff dates');
ERROR:  diff dates
DETAIL:  Plunit.assertation fails (assert_equals).
select plunit.assert_equals(10.2, 10.3, 0.5);
 assert_equals 
---------------
 
(1 row)

select plunit.assert_equals(10.2, 10.3, 0.01, 'attention some diff');
ERROR:  attention some diff
DETAIL:  Plunit.assertation fails (assert_equals).
select plunit.assert_not_equals(current_date, current_date + 1, 'yestarday is today');
 assert_not_equals 
-------------------
 
(1 row)

select plunit.fail();
ERROR:  plunit.assert_fail exception
DETAIL:  Plunit.assertation (assert_fail).
select plunit.fail('custom exception');
ERROR:  custom exception
DETAIL:  Plunit.assertation (assert_fail).
